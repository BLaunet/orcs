

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Wavelength recalibration with the sky lines (Mendel OH bands) &mdash; Orcs 2.0.0b documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Orcs 2.0.0b documentation" href="index.html"/>
        <link rel="next" title="Core module" href="core_module.html"/>
        <link rel="prev" title="Modelling and fitting two unresolved emission lines with a bayesian approach" href="script_example_model+fit_2_lines_bayes.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Orcs
          

          
            
            <img src="_static/logo_sidebar.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.0.0b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="script_example_fit_a_single_spectrum.html">Example of a single spectrum fit.</a></li>
<li class="toctree-l1"><a class="reference internal" href="script_example_model+fit_1_line.html">Modelling and fitting a single line spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="script_example_model+fit_2_lines.html">Modelling and fitting a spectrum with two resolved lines</a></li>
<li class="toctree-l1"><a class="reference internal" href="script_example_model+fit_2_lines_bayes.html">Modelling and fitting two unresolved emission lines with a bayesian approach</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Wavelength recalibration with the sky lines (Mendel OH bands)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#First-step:-checking-the-calibration">First step: checking the calibration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fitting-the-sky-spectrum">fitting the sky spectrum</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Second-step:-Mapping-the-sky-velocity">Second step: Mapping the sky velocity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Resulting-data">Resulting data</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core_module.html">Core module</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_module.html">Process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rvcorrect_module.html">RVCorrect module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils_module.html">Utils module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="script_example_fit_a_single_spectrum.html">Example of a single spectrum fit.</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Orcs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Wavelength recalibration with the sky lines (Mendel OH bands)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/script_example_wavelength_calibration.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Wavelength-recalibration-with-the-sky-lines-(Mendel-OH-bands)">
<h1>Wavelength recalibration with the sky lines (Mendel OH bands)<a class="headerlink" href="#Wavelength-recalibration-with-the-sky-lines-(Mendel-OH-bands)" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>Data can be recalibrated in wavelength easily when one OH sky lines are
visible in most parts of the field of view. Cubes observed in the red
part of the spectrum (e.g. SN3 filter) are especially interesting in
this respect.</p>
<p>The general idea is to extract integrated spectra at different positions
in the field of view and measure the velocity of the sky lines (which
should be 0 if the calibration was perfect) (see <a class="reference external" href="https://arxiv.org/abs/1707.01366">Martin et al.
2017a</a>).</p>
<div class="figure" id="id1">
<img alt="skymap-fig0.svg" src="_images/skymap-fig0.svg" /><p class="caption"><span class="caption-text">skymap-fig0.svg</span></p>
</div>
<p>Then the correction map can be infered at each pixel by fitting a model.</p>
<div class="figure" id="id2">
<img alt="skymap-fig1.svg" src="_images/skymap-fig1.svg" /><p class="caption"><span class="caption-text">skymap-fig1.svg</span></p>
</div>
<p>The calibration model is based on a simple modeling of the
interferometer.</p>
<div class="figure" id="id3">
<img alt="coords0.svg" src="_images/coords0.svg" /><p class="caption"><span class="caption-text">coords0.svg</span></p>
</div>
</div>
<div class="section" id="First-step:-checking-the-calibration">
<h2>First step: checking the calibration<a class="headerlink" href="#First-step:-checking-the-calibration" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># inline plotting for jupyter notebook. Do not put this line in a real python script.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># import base class for the manipulation of a SITELLE spectral cube: HDFCube</span>
<span class="kn">from</span> <span class="nn">orcs.process</span> <span class="kn">import</span> <span class="n">SpectralCube</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># load spectral cube</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">SpectralCube</span><span class="p">(</span><span class="s1">&#39;/home/thomas/M31_SN3.merged.cm1.1.0.hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
17-07-19|08:42:26 # SpectralCube.__init__ &gt; Data shape : (2048, 2064, 840)
17-07-19|08:42:26 # SpectralCube.__init__ &gt; Cube is in WAVENUMBER (cm-1)
17-07-19|08:42:26 # SpectralCube.__init__ &gt; Cube is CALIBRATED
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># extract and plot a spectrum of a large integrated region. The sky lines should appear.</span>
<span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">extract_spectrum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.028 s]
Init of the parallel processing server with 4 threads
 [==========] [100%] [completed in 0.787 s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(14500, 15500)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_5_2.png" src="_images/script_example_wavelength_calibration_5_2.png" />
</div>
</div>
<div class="section" id="fitting-the-sky-spectrum">
<h3>fitting the sky spectrum<a class="headerlink" href="#fitting-the-sky-spectrum" title="Permalink to this headline">¶</a></h3>
<p>we can also fit the integrated spectrum because there si a large number
of sky lines and because we are not interested in a perfect fit (only
the velocity is required), we can use a simple &#8216;sinc&#8217; model with a fixed
fwhm. All the lines are set to share the same velocity parameter and we
set an inital guess of the velocity around 80 km/s. This general bias of
80 km/s is known (<a class="reference external" href="https://arxiv.org/abs/1706.03230">Martin et al.
2017b</a>) and comes from the error
made on the real wavelength of the calibration laser (which is falsely
considered to be at 453.5 nm).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sky_lines_cm1</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_sky_lines</span><span class="p">()</span>
<span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">fit_res</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">fit_lines_in_spectrum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">sky_lines_cm1</span><span class="p">,</span>
                                                     <span class="n">fmodel</span><span class="o">=</span><span class="s1">&#39;sinc&#39;</span><span class="p">,</span>
                                                     <span class="n">pos_def</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                                     <span class="n">fwhm_def</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                                                     <span class="n">nofilter</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                     <span class="n">pos_cov</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">===== Results ======&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Velocity: &#39;</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;velocity_gvar&#39;</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;fitted_vector&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.026 s]
Init of the parallel processing server with 4 threads
 [==========] [100%] [completed in 0.729 s]

===== Results ======
Velocity:  [73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6)
 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6)
 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6)
 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6)
 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6) 73.8(1.6)
 73.8(1.6)]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(14500, 15500)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_7_2.png" src="_images/script_example_wavelength_calibration_7_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Second-step:-Mapping-the-sky-velocity">
<h2>Second step: Mapping the sky velocity<a class="headerlink" href="#Second-step:-Mapping-the-sky-velocity" title="Permalink to this headline">¶</a></h2>
<p>Warning: this process can take a long time because a spectrum is
extracted and fitted for each point of a 40x40 grid by default. For a
basic example it is recommended to limit the number of grid division to
10x10.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">cube</span><span class="o">.</span><span class="n">map_sky_velocity</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">div_nb</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># the mean velocity bias is set around 80 km/s</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
17-07-19|08:42:31 # SpectralCube.map_sky_velocity &gt; X range: 0 2048, Y range: 0 2064
17-07-19|08:42:31 # SpectralCube.map_sky_velocity &gt; Radius: 85.3333333333
17-07-19|08:42:31 # SpectralCube.map_sky_velocity &gt; 100 regions to fit
 loading region: Shape : circle ( Number(1861.81818),Number(1876.36364),Number(85.33333) )

17-07-19|08:42:35 # SpectralCube._fit_integrated_spectra &gt; Fitting region 0/100
Velocity of the first line (km/s): 77.4(1.4)
17-07-19|08:42:41 # SpectralCube._fit_integrated_spectra &gt; Fitting region 1/100
Velocity of the first line (km/s): 76.7(1.4)
17-07-19|08:42:46 # SpectralCube._fit_integrated_spectra &gt; Fitting region 2/100
Velocity of the first line (km/s): 73.4(1.5)
17-07-19|08:42:52 # SpectralCube._fit_integrated_spectra &gt; Fitting region 3/100
Velocity of the first line (km/s): 71.8(1.4)
17-07-19|08:42:58 # SpectralCube._fit_integrated_spectra &gt; Fitting region 4/100
Velocity of the first line (km/s): 71.1(1.6)
17-07-19|08:43:04 # SpectralCube._fit_integrated_spectra &gt; Fitting region 5/100
Velocity of the first line (km/s): 70.3(1.8)
17-07-19|08:43:10 # SpectralCube._fit_integrated_spectra &gt; Fitting region 6/100
Velocity of the first line (km/s): 69.6(1.8)
17-07-19|08:43:15 # SpectralCube._fit_integrated_spectra &gt; Fitting region 7/100
Velocity of the first line (km/s): 68.5(1.9)
17-07-19|08:43:21 # SpectralCube._fit_integrated_spectra &gt; Fitting region 8/100
Velocity of the first line (km/s): 72.4(2.1)
17-07-19|08:43:29 # SpectralCube._fit_integrated_spectra &gt; Fitting region 9/100
Velocity of the first line (km/s): 70.3(1.8)
17-07-19|08:43:39 # SpectralCube._fit_integrated_spectra &gt; Fitting region 10/100
Velocity of the first line (km/s): 78.3(1.4)
17-07-19|08:43:47 # SpectralCube._fit_integrated_spectra &gt; Fitting region 11/100
Velocity of the first line (km/s): 77.3(1.4)
17-07-19|08:43:53 # SpectralCube._fit_integrated_spectra &gt; Fitting region 12/100
Velocity of the first line (km/s): 74.9(1.5)
17-07-19|08:44:01 # SpectralCube._fit_integrated_spectra &gt; Fitting region 13/100
Velocity of the first line (km/s): 71.4(1.4)
17-07-19|08:44:11 # SpectralCube._fit_integrated_spectra &gt; Fitting region 14/100
Velocity of the first line (km/s): 71.3(1.6)
17-07-19|08:44:19 # SpectralCube._fit_integrated_spectra &gt; Fitting region 15/100
Velocity of the first line (km/s): 70.9(1.8)
17-07-19|08:44:27 # SpectralCube._fit_integrated_spectra &gt; Fitting region 16/100
Velocity of the first line (km/s): 68.5(1.7)
17-07-19|08:44:35 # SpectralCube._fit_integrated_spectra &gt; Fitting region 17/100
Velocity of the first line (km/s): 67.9(1.7)
17-07-19|08:44:45 # SpectralCube._fit_integrated_spectra &gt; Fitting region 18/100
Velocity of the first line (km/s): 69.1(1.9)
17-07-19|08:44:53 # SpectralCube._fit_integrated_spectra &gt; Fitting region 19/100
Velocity of the first line (km/s): 70.5(1.7)
17-07-19|08:45:02 # SpectralCube._fit_integrated_spectra &gt; Fitting region 20/100
Velocity of the first line (km/s): 78.5(1.5)
17-07-19|08:45:11 # SpectralCube._fit_integrated_spectra &gt; Fitting region 21/100
Velocity of the first line (km/s): 78.6(1.5)
17-07-19|08:45:20 # SpectralCube._fit_integrated_spectra &gt; Fitting region 22/100
Velocity of the first line (km/s): 75.6(1.3)
17-07-19|08:45:27 # SpectralCube._fit_integrated_spectra &gt; Fitting region 23/100
Velocity of the first line (km/s): 74.1(1.3)
17-07-19|08:45:36 # SpectralCube._fit_integrated_spectra &gt; Fitting region 24/100
Velocity of the first line (km/s): 115.7(1.9)
17-07-19|08:45:53 # SpectralCube._fit_integrated_spectra &gt; Fitting region 25/100
Velocity of the first line (km/s): 75.7(2.0)
17-07-19|08:46:02 # SpectralCube._fit_integrated_spectra &gt; Fitting region 26/100
Velocity of the first line (km/s): 71.1(1.9)
17-07-19|08:46:09 # SpectralCube._fit_integrated_spectra &gt; Fitting region 27/100
Velocity of the first line (km/s): 69.1(1.7)
17-07-19|08:46:17 # SpectralCube._fit_integrated_spectra &gt; Fitting region 28/100
Velocity of the first line (km/s): 69.9(1.9)
17-07-19|08:46:25 # SpectralCube._fit_integrated_spectra &gt; Fitting region 29/100
Velocity of the first line (km/s): 71.9(1.7)
17-07-19|08:46:32 # SpectralCube._fit_integrated_spectra &gt; Fitting region 30/100
Velocity of the first line (km/s): 79.3(1.5)
17-07-19|08:46:41 # SpectralCube._fit_integrated_spectra &gt; Fitting region 31/100
Velocity of the first line (km/s): 79.0(1.4)
17-07-19|08:46:50 # SpectralCube._fit_integrated_spectra &gt; Fitting region 32/100
Velocity of the first line (km/s): 76.0(1.3)
17-07-19|08:46:58 # SpectralCube._fit_integrated_spectra &gt; Fitting region 33/100
Velocity of the first line (km/s): 68.3(1.5)
17-07-19|08:47:05 # SpectralCube._fit_integrated_spectra &gt; Fitting region 34/100
Velocity of the first line (km/s): 76.8(1.4)
17-07-19|08:47:12 # SpectralCube._fit_integrated_spectra &gt; Fitting region 35/100
Velocity of the first line (km/s): 126.5(2.2)
17-07-19|08:47:22 # SpectralCube._fit_integrated_spectra &gt; Fitting region 36/100
Velocity of the first line (km/s): 74.4(2.3)
17-07-19|08:47:29 # SpectralCube._fit_integrated_spectra &gt; Fitting region 37/100
Velocity of the first line (km/s): 71.2(1.9)
17-07-19|08:47:38 # SpectralCube._fit_integrated_spectra &gt; Fitting region 38/100
Velocity of the first line (km/s): 70.2(1.8)
17-07-19|08:47:44 # SpectralCube._fit_integrated_spectra &gt; Fitting region 39/100
Velocity of the first line (km/s): 73.5(1.5)
17-07-19|08:47:54 # SpectralCube._fit_integrated_spectra &gt; Fitting region 40/100
Velocity of the first line (km/s): 79.8(1.5)
17-07-19|08:48:04 # SpectralCube._fit_integrated_spectra &gt; Fitting region 41/100
Velocity of the first line (km/s): 77.5(1.8)
17-07-19|08:48:13 # SpectralCube._fit_integrated_spectra &gt; Fitting region 42/100
Velocity of the first line (km/s): 79.0(1.6)
17-07-19|08:48:22 # SpectralCube._fit_integrated_spectra &gt; Fitting region 43/100
Velocity of the first line (km/s): 89.4(2.6)
17-07-19|08:48:29 # SpectralCube._fit_integrated_spectra &gt; Fitting region 44/100
Velocity of the first line (km/s): 75.1(2.6)
17-07-19|08:48:35 # SpectralCube._fit_integrated_spectra &gt; Fitting region 45/100
Velocity of the first line (km/s): 86.1(3.9)
17-07-19|08:48:41 # SpectralCube._fit_integrated_spectra &gt; Fitting region 46/100
Velocity of the first line (km/s): 77.3(3.4)
17-07-19|08:48:50 # SpectralCube._fit_integrated_spectra &gt; Fitting region 47/100
Velocity of the first line (km/s): 73.2(2.1)
17-07-19|08:48:58 # SpectralCube._fit_integrated_spectra &gt; Fitting region 48/100
Velocity of the first line (km/s): 72.8(1.7)
17-07-19|08:49:07 # SpectralCube._fit_integrated_spectra &gt; Fitting region 49/100
Velocity of the first line (km/s): 75.5(1.4)
17-07-19|08:49:16 # SpectralCube._fit_integrated_spectra &gt; Fitting region 50/100
Velocity of the first line (km/s): 81.7(1.5)
17-07-19|08:49:25 # SpectralCube._fit_integrated_spectra &gt; Fitting region 51/100
Velocity of the first line (km/s): 81.2(1.4)
17-07-19|08:49:34 # SpectralCube._fit_integrated_spectra &gt; Fitting region 52/100
Velocity of the first line (km/s): 81.0(2.0)
17-07-19|08:49:43 # SpectralCube._fit_integrated_spectra &gt; Fitting region 53/100
Velocity of the first line (km/s): 77.4(2.1)
17-07-19|08:49:49 # SpectralCube._fit_integrated_spectra &gt; Fitting region 54/100
Velocity of the first line (km/s): 76.8(4.3)
17-07-19|08:49:55 # SpectralCube._fit_integrated_spectra &gt; Fitting region 55/100
Velocity of the first line (km/s): 83.7(3.5)
17-07-19|08:50:03 # SpectralCube._fit_integrated_spectra &gt; Fitting region 56/100
Velocity of the first line (km/s): 74.8(2.8)
17-07-19|08:50:11 # SpectralCube._fit_integrated_spectra &gt; Fitting region 57/100
Velocity of the first line (km/s): 77.1(1.7)
17-07-19|08:50:20 # SpectralCube._fit_integrated_spectra &gt; Fitting region 58/100
Velocity of the first line (km/s): 77.8(1.4)
17-07-19|08:50:29 # SpectralCube._fit_integrated_spectra &gt; Fitting region 59/100
Velocity of the first line (km/s): 78.9(1.2)
17-07-19|08:50:38 # SpectralCube._fit_integrated_spectra &gt; Fitting region 60/100
Velocity of the first line (km/s): 80.9(1.6)
17-07-19|08:50:48 # SpectralCube._fit_integrated_spectra &gt; Fitting region 61/100
Velocity of the first line (km/s): 80.6(1.5)
17-07-19|08:50:56 # SpectralCube._fit_integrated_spectra &gt; Fitting region 62/100
Velocity of the first line (km/s): 82.2(2.4)
17-07-19|08:51:04 # SpectralCube._fit_integrated_spectra &gt; Fitting region 63/100
Velocity of the first line (km/s): 76.5(3.0)
17-07-19|08:51:11 # SpectralCube._fit_integrated_spectra &gt; Fitting region 64/100
Velocity of the first line (km/s): 79.4(2.9)
17-07-19|08:51:18 # SpectralCube._fit_integrated_spectra &gt; Fitting region 65/100
Velocity of the first line (km/s): 71.0(2.4)
17-07-19|08:51:24 # SpectralCube._fit_integrated_spectra &gt; Fitting region 66/100
Velocity of the first line (km/s): 76.1(1.8)
17-07-19|08:51:32 # SpectralCube._fit_integrated_spectra &gt; Fitting region 67/100
Velocity of the first line (km/s): 79.5(1.2)
17-07-19|08:51:40 # SpectralCube._fit_integrated_spectra &gt; Fitting region 68/100
Velocity of the first line (km/s): 80.8(1.0)
17-07-19|08:51:48 # SpectralCube._fit_integrated_spectra &gt; Fitting region 69/100
Velocity of the first line (km/s): 84.4(1.3)
17-07-19|08:51:57 # SpectralCube._fit_integrated_spectra &gt; Fitting region 70/100
Velocity of the first line (km/s): 83.0(1.6)
17-07-19|08:52:07 # SpectralCube._fit_integrated_spectra &gt; Fitting region 71/100
Velocity of the first line (km/s): 84.0(1.5)
17-07-19|08:52:16 # SpectralCube._fit_integrated_spectra &gt; Fitting region 72/100
Velocity of the first line (km/s): 82.1(2.0)
17-07-19|08:52:24 # SpectralCube._fit_integrated_spectra &gt; Fitting region 73/100
Velocity of the first line (km/s): 78.8(2.4)
17-07-19|08:52:33 # SpectralCube._fit_integrated_spectra &gt; Fitting region 74/100
Velocity of the first line (km/s): 79.5(2.4)
17-07-19|08:52:41 # SpectralCube._fit_integrated_spectra &gt; Fitting region 75/100
Velocity of the first line (km/s): 77.7(1.8)
17-07-19|08:52:50 # SpectralCube._fit_integrated_spectra &gt; Fitting region 76/100
Velocity of the first line (km/s): 76.8(1.4)
17-07-19|08:52:58 # SpectralCube._fit_integrated_spectra &gt; Fitting region 77/100
Velocity of the first line (km/s): 76.0(1.0)
17-07-19|08:53:07 # SpectralCube._fit_integrated_spectra &gt; Fitting region 78/100
Velocity of the first line (km/s): 79.30(87)
17-07-19|08:53:16 # SpectralCube._fit_integrated_spectra &gt; Fitting region 79/100
Velocity of the first line (km/s): 84.80(96)
17-07-19|08:53:24 # SpectralCube._fit_integrated_spectra &gt; Fitting region 80/100
Velocity of the first line (km/s): 85.1(1.8)
17-07-19|08:53:34 # SpectralCube._fit_integrated_spectra &gt; Fitting region 81/100
Velocity of the first line (km/s): 84.1(1.4)
17-07-19|08:53:42 # SpectralCube._fit_integrated_spectra &gt; Fitting region 82/100
Velocity of the first line (km/s): 83.6(1.4)
17-07-19|08:53:51 # SpectralCube._fit_integrated_spectra &gt; Fitting region 83/100
Velocity of the first line (km/s): 79.6(1.5)
17-07-19|08:54:00 # SpectralCube._fit_integrated_spectra &gt; Fitting region 84/100
Velocity of the first line (km/s): 81.8(1.5)
17-07-19|08:54:09 # SpectralCube._fit_integrated_spectra &gt; Fitting region 85/100
Velocity of the first line (km/s): 78.3(1.4)
17-07-19|08:54:19 # SpectralCube._fit_integrated_spectra &gt; Fitting region 86/100
Velocity of the first line (km/s): 79.7(1.1)
17-07-19|08:54:26 # SpectralCube._fit_integrated_spectra &gt; Fitting region 87/100
Velocity of the first line (km/s): 82.94(89)
17-07-19|08:54:36 # SpectralCube._fit_integrated_spectra &gt; Fitting region 88/100
Velocity of the first line (km/s): 82.91(79)
17-07-19|08:54:44 # SpectralCube._fit_integrated_spectra &gt; Fitting region 89/100
Velocity of the first line (km/s): 85.33(94)
17-07-19|08:54:53 # SpectralCube._fit_integrated_spectra &gt; Fitting region 90/100
Velocity of the first line (km/s): 86.4(1.7)
17-07-19|08:55:03 # SpectralCube._fit_integrated_spectra &gt; Fitting region 91/100
Velocity of the first line (km/s): 85.4(1.5)
17-07-19|08:55:11 # SpectralCube._fit_integrated_spectra &gt; Fitting region 92/100
Velocity of the first line (km/s): 83.1(1.4)
17-07-19|08:55:19 # SpectralCube._fit_integrated_spectra &gt; Fitting region 93/100
Velocity of the first line (km/s): 81.0(1.3)
17-07-19|08:55:28 # SpectralCube._fit_integrated_spectra &gt; Fitting region 94/100
Velocity of the first line (km/s): 82.9(1.1)
17-07-19|08:55:37 # SpectralCube._fit_integrated_spectra &gt; Fitting region 95/100
Velocity of the first line (km/s): 85.0(1.0)
17-07-19|08:55:46 # SpectralCube._fit_integrated_spectra &gt; Fitting region 96/100
Velocity of the first line (km/s): 84.44(88)
17-07-19|08:55:55 # SpectralCube._fit_integrated_spectra &gt; Fitting region 97/100
Velocity of the first line (km/s): 84.72(77)
17-07-19|08:56:05 # SpectralCube._fit_integrated_spectra &gt; Fitting region 98/100
Velocity of the first line (km/s): 85.19(83)
17-07-19|08:56:15 # SpectralCube._fit_integrated_spectra &gt; Fitting region 99/100
Velocity of the first line (km/s): 84.50(96)
First laser wavelentgh calibration estimation: 543.356235946 nm
Angle at the center of the frame: 15.4977038652
&gt; Binning calibration map
&gt; Calibration laser map fit
  &gt; First fit on the central portion of the calibration laser map (30.0% of the total size)
    &gt; Calibration laser map fit parameters:
    distance to mirror: 23.6954632448 cm
    X angle from the optical axis to the center: 0.0 degrees (Fixed)
    Y angle from the optical axis to the center: 15.5050669216 degrees
    Tip-tilt angle of the detector along X: 0.0 degrees (Fixed)
    Tip-tilt angle of the detector along Y: 0.0 degrees (Fixed)
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.356235946 nm (Fixed)
    Error on fit: mean -1.16831223579e-06, std 0.0515054158154 (in nm)
    Error on fit: mean -0.000645053185275, std 28.437374456 (in km/s)
  &gt; Second fit on the central portion of the calibration laser map (30.0% of the total size)
    &gt; Calibration laser map fit parameters:
    distance to mirror: 23.6792529911 cm
    X angle from the optical axis to the center: -0.467393834246 degrees
    Y angle from the optical axis to the center: 15.4980058922 degrees
    Tip-tilt angle of the detector along X: 0.427357564651 degrees
    Tip-tilt angle of the detector along Y: -1.24571403707 degrees
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.356235946 nm (Fixed)
    Error on fit: mean -3.94460707057e-07, std 0.000791471197978 (in nm)
    Error on fit: mean -0.000217791210054, std 0.436990216888 (in km/s)
  &gt; Third fit on a larger portion of the map (50.0% of the total size)
    &gt; Calibration laser map fit parameters:
    distance to mirror: 23.7163902827 cm
    X angle from the optical axis to the center: -0.467753337786 degrees
    Y angle from the optical axis to the center: 15.498384909 degrees
    Tip-tilt angle of the detector along X: 0.311296394954 degrees
    Tip-tilt angle of the detector along Y: -0.724167834406 degrees
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.356235946 nm (Fixed)
    Error on fit: mean -2.73378866828e-06, std 0.00312555663736 (in nm)
    Error on fit: mean -0.00150939024203, std 1.72569472691 (in km/s)
  &gt; Zernike polynomials fit of the residual wavefront
Standard deviation of the residual: 1.84989027732e-05
Median relative error (err/val)): 0.05%
&gt; final error (std on 50.0% of the total size): 1.764e-05 nm, 9.739e-03 km/s
    &gt; New calibration laser map fit parameters:
    distance to mirror: 23.7225685337 cm
    X angle from the optical axis to the center: -0.00245928689611 degrees
    Y angle from the optical axis to the center: 15.5159105839 degrees
    Tip-tilt angle of the detector along X: 1.1997369795 degrees
    Tip-tilt angle of the detector along Y: 0.112798774753 degrees
    Rotation angle of the detector: 1.76000785274 degrees
    Calibration laser wavelength: 543.334514481 nm

fit residual std (in km/s): 1.67457474408
median error on the data (in km/s) 1.41094439599
Data written as M31_SN3.1.0.ORCS/M31_SN3.1.0.calibration_laser_map.fits in 0.19 s
Data written as M31_SN3.1.0.ORCS/M31_SN3.1.0.wavefront_map.fits in 0.18 s
Data written as M31_SN3.1.0.ORCS/M31_SN3.1.0.skymap.fits in 0.18 s
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_1.png" src="_images/script_example_wavelength_calibration_9_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_2.png" src="_images/script_example_wavelength_calibration_9_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_3.png" src="_images/script_example_wavelength_calibration_9_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_4.png" src="_images/script_example_wavelength_calibration_9_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_5.png" src="_images/script_example_wavelength_calibration_9_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_6.png" src="_images/script_example_wavelength_calibration_9_6.png" />
</div>
</div>
</div>
<div class="section" id="Resulting-data">
<h2>Resulting data<a class="headerlink" href="#Resulting-data" title="Permalink to this headline">¶</a></h2>
<p>The most important result is the skymap which gives the modelized
velocity of the sky in the field of view and permit to correct the
measured velocities in the cube.This map is named <code class="docutils literal"><span class="pre">*skymap.fits</span></code>.</p>
<p>In this particular case this is
<code class="docutils literal"><span class="pre">M31_SN3.1.0.ORCS/M31_SN3.1.0.skymap.fits</span></code></p>
<p>The histogram displays the difference between the measured velocity and
the fitted velocity at each valid data point.</p>
<p>You can see by looking at the other maps that in the cas of M31 there
are some data points at the center of the field which could not give a
valid velocity of the sky. This comes from the fact that M31 is very
bright at the center and the sky lines are lost in the noise produced by
the high continuum background. Modelling the interferometer makes
possible to estimate the velocity of the lines at the center of the
field where no real data has been obtained. And the result is stricking,
it works particularly well even if the case of M31 (<a class="reference external" href="https://arxiv.org/abs/1707.01366">Martin et al.
2017a</a>)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="core_module.html" class="btn btn-neutral float-right" title="Core module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="script_example_model+fit_2_lines_bayes.html" class="btn btn-neutral" title="Modelling and fitting two unresolved emission lines with a bayesian approach" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Thomas Martin (thomas.martin.1@ulaval.ca).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0b',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>